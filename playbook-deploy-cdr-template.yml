---
- name: Import Zabbix Template â€“ CDR
  hosts: localhost
  connection: local
  gather_facts: no

  vars:
    zabbix_url: "{{ lookup('env','ZABBIX_API_URL') }}"
    zabbix_user: "{{ lookup('env','ZABBIX_USERNAME') }}"
    zabbix_password: "{{ lookup('env','ZABBIX_PASSWORD') }}"
    template_file: "{{ template_file }}"

  tasks:

    - name: Import Zabbix object (Template)
      community.zabbix.zabbix_import:
        server_url: "{{ zabbix_url }}"
        login_user: "{{ zabbix_user }}"
        login_password: "{{ zabbix_password }}"
        source: "{{ lookup('file', template_file) }}"
        format: xml
        rules:
          templates:
            createMissing: true
            updateExisting: true

    - name: Print result
      debug:
        msg: "Template import completed."
